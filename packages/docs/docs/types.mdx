---
sidebar_position: 7
title: Types
---

This page documents the public TypeScript types you’ll most commonly touch when using VizCraft.

:::tip
All types shown here are exported from `vizcraft` and can be imported as `import type { ... } from 'vizcraft'`.
:::

---

## VizScene

A scene is the complete, serializable description of what to render.

**Shape**

- `viewBox: { w: number; h: number }` — the SVG coordinate space.
- `nodes: VizNode[]` — nodes to render.
- `edges: VizEdge[]` — edges to render.
- `overlays?: VizOverlaySpec[]` — optional overlay layer.
- `animationSpecs?: AnimationSpec[]` — optional data-only timelines compiled via `builder.animate(...)`.
- `sketch?: { enabled?: boolean; seed?: number }` — global sketch / hand-drawn rendering mode.

---

## VizPlugin {#vizplugin}

A plugin function that can be ingested by a `VizBuilder` using the `.use()` method to extend functionality or mutate the scene fluently.

**Signature**

```typescript
type VizPlugin<Options = any> = (
  builder: VizBuilder,
  options?: Options
) => void;
```

---

## VizNode

A node in the scene graph.

**Key properties**

- `id: string` — unique id.
- `pos: { x: number; y: number }` — base position.
- `shape: NodeShape` — geometry.
- `label?: NodeLabel` — optional text label.
- `style?: { fill?: string; stroke?: string; strokeWidth?: number; opacity?: number; strokeDasharray?: string; shadow?: { dx?: number; dy?: number; blur?: number; color?: string }; sketch?: boolean; sketchSeed?: number }` — base styling. `strokeDasharray` accepts presets (`'dashed'`, `'dotted'`, `'dash-dot'`, `'solid'`) or any SVG dasharray string. `shadow` adds a drop shadow via an SVG filter (defaults: dx=2, dy=2, blur=4, color=rgba(0,0,0,0.2)). `sketch` enables hand-drawn rendering; `sketchSeed` controls deterministic jitter.
- `className?: string` — extra CSS class.
- `runtime?: VizRuntimeNodeProps` — **runtime-only** overrides (what the animation system writes).
- `animations?: VizAnimSpec[]` — registry/CSS animation requests (e.g. `pulse`, `flow`).
- `data?: unknown` — your payload.
- `parentId?: string` — parent container node id (makes this node a child of that container).
- `container?: ContainerConfig` — marks this node as a container and configures grouping behaviour.
- `ports?: NodePort[]` — explicit connection ports. When set, edges can target specific ports via `fromPort` / `toPort`. When omitted, every shape provides sensible default ports (see [NodePort](#nodeport)).

---

## ContainerConfig

Configuration for a container / group node. Applied via `.container(config?)` on the builder.

- `layout?: 'free' | 'vertical' | 'horizontal'` — child layout direction (default `'free'`).
- `padding?: { top: number; right: number; bottom: number; left: number }` — interior padding.
- `autoSize?: boolean` — whether the container auto-resizes to fit children.
- `headerHeight?: number` — height of the header band for swimlane-style headers. When set, a separator line is rendered at this offset from the container's top edge and the node label is centred inside the header area.

---

## VizEdge

An edge connecting two nodes. All edges are rendered as `<path>` elements.

**Key properties**

- `id: string` — unique id (commonly `"a->b"`).
- `from: string` / `to: string` — node ids.
- `fromPort?: string` — connect from a specific port on the source node (by port `id`).
- `toPort?: string` — connect to a specific port on the target node (by port `id`).
- `routing?: 'straight' | 'curved' | 'orthogonal'` — path routing algorithm (default `'straight'`).
- `waypoints?: Vec2[]` — intermediate points the edge must pass through.
- `markerEnd?: EdgeMarkerType` — marker/arrowhead at the target end of the edge.
- `markerStart?: EdgeMarkerType` — marker/arrowhead at the source end of the edge.
- `anchor?: 'center' | 'boundary'` — connection behavior.
- `labels?: EdgeLabel[]` — text labels at various positions along the edge. Each label has a `position` (`'start'`, `'mid'`, or `'end'`). Chain `.label()` calls on the builder to add multiple labels.
- `label?: EdgeLabel` — _(deprecated)_ single label. Kept for backwards compatibility; prefer `labels`.
- `style?: { stroke?: string; strokeWidth?: number; fill?: string; opacity?: number; strokeDasharray?: string; sketch?: boolean }` — per-edge visual styling. `strokeDasharray` accepts presets (`'dashed'`, `'dotted'`, `'dash-dot'`, `'solid'`) or any SVG dasharray string. `sketch` enables hand-drawn rendering. When set, inline SVG attributes override the CSS class defaults.
- `runtime?: VizRuntimeEdgeProps` — **runtime-only** overrides (what the animation system writes).
- `animations?: VizAnimSpec[]` — registry/CSS animation requests.
- `meta?: Record<string, unknown>` — arbitrary consumer-defined metadata.
- `data?: unknown` — your payload.

### EdgeRouting

| Mode           | Description                                                                                               |
| -------------- | --------------------------------------------------------------------------------------------------------- |
| `'straight'`   | Direct line (default). With waypoints, produces a polyline.                                               |
| `'curved'`     | Smooth bezier curve. Auto-computed control point without waypoints; Catmull-Rom spline through waypoints. |
| `'orthogonal'` | Right-angle (elbow) connectors. Auto L-shaped without waypoints; elbow segments through each waypoint.    |

### EdgeMarkerType {#edge-marker-type}

Marker/arrowhead styles for edge endpoints. Used by both `markerEnd` and `markerStart` on `VizEdge`.

| Type            | Description                         | Use case                           |
| --------------- | ----------------------------------- | ---------------------------------- |
| `'none'`        | No marker                           | Plain line                         |
| `'arrow'`       | Filled triangle (default arrowhead) | Dependency / association           |
| `'arrowOpen'`   | Open / unfilled triangle (V shape)  | Inheritance / generalization (UML) |
| `'diamond'`     | Filled diamond                      | Composition (UML)                  |
| `'diamondOpen'` | Open diamond                        | Aggregation (UML)                  |
| `'circle'`      | Filled circle                       | Navigable association              |
| `'circleOpen'`  | Open circle                         | Association endpoint               |
| `'square'`      | Filled square                       | Custom endpoint                    |
| `'bar'`         | Perpendicular line (T shape)        | "Exactly one" (ER cardinality)     |
| `'halfArrow'`   | Single-sided arrow (one wing)       | Custom directional hint            |

### EdgeLabel

A text label rendered on an edge path.

| Property      | Type                        | Description                                                                                                                                      |
| ------------- | --------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| `text`        | `string`                    | The label text.                                                                                                                                  |
| `rich?`       | `RichText`                  | Optional rich / mixed-format label. When present, VizCraft renders this instead of `text`.                                                       |
| `position`    | `'start' \| 'mid' \| 'end'` | Where on the path to place the label. `'start'` is ~15 % from the source, `'mid'` (default) is the midpoint, `'end'` is ~85 % toward the target. |
| `className?`  | `string`                    | Optional CSS class applied to the `<text>` element.                                                                                              |
| `dx?`         | `number`                    | Horizontal offset (SVG `dx` attribute).                                                                                                          |
| `dy?`         | `number`                    | Vertical offset (SVG `dy` attribute). Defaults to `-10` to sit above the path.                                                                   |
| `fill?`       | `string`                    | Text fill color.                                                                                                                                 |
| `fontSize?`   | `number \| string`          | Font size (e.g. `14` or `'1.2em'`).                                                                                                              |
| `fontWeight?` | `number \| string`          | Font weight (e.g. `'bold'`, `700`).                                                                                                              |
| `fontFamily?` | `string`                    | Custom font family (e.g. `'Georgia'`).                                                                                                           |

### NodeLabel

A text label rendered inside (or near) a node.

| Property      | Type               | Description                                                                                |
| ------------- | ------------------ | ------------------------------------------------------------------------------------------ |
| `text`        | `string`           | The label text.                                                                            |
| `rich?`       | `RichText`         | Optional rich / mixed-format label. When present, VizCraft renders this instead of `text`. |
| `className?`  | `string`           | Optional CSS class applied to the `<text>` element.                                        |
| `dx?`         | `number`           | Horizontal offset.                                                                         |
| `dy?`         | `number`           | Vertical offset.                                                                           |
| `fill?`       | `string`           | Text fill color.                                                                           |
| `fontSize?`   | `number \| string` | Font size (e.g. `14` or `'1.2em'`).                                                        |
| `fontWeight?` | `number \| string` | Font weight (e.g. `'bold'`, `700`).                                                        |
| `fontFamily?` | `string`           | Custom font family (e.g. `'Comic Sans MS'`).                                               |

### RichText

`RichText` is a small token model used by `.richLabel((l) => ...)` and by declarative options (`label.rich`).

```ts
type RichText = { kind: 'rich'; tokens: RichTextToken[] };

type RichTextToken =
  | {
      kind: 'span';
      text: string;
      bold?: boolean;
      italic?: boolean;
      underline?: boolean;
      code?: boolean;
      href?: string;
      fill?: string;
      fontSize?: number | string;
      fontWeight?: number | string;
      fontFamily?: string;
      baselineShift?: 'sub' | 'super';
      className?: string;
    }
  | { kind: 'newline' };
```

:::note
Rich text labels currently don’t auto-wrap to a `maxWidth`. Use newline tokens (or `.newline()` in the builder) to control line breaks.
:::

---

## NodePort {#nodeport}

A named connection point on a node. Ports let edges attach to precise positions rather than the generic boundary intersection.

**Shape**

- `id: string` — unique identifier within the node (e.g. `'top'`, `'right'`, `'in-1'`).
- `offset: Vec2` — position relative to the node center (`{ x, y }`).
- `direction?: number` — outgoing angle in degrees (0 = right, 90 = down, 180 = left, 270 = up). Used for tangent-aware edge routing.

### Default ports

Every built-in shape provides default ports automatically — you don't need to declare ports for common cases:

| Shape                                              | Default ports              | Ids                                                                     |
| -------------------------------------------------- | -------------------------- | ----------------------------------------------------------------------- |
| `rect`, `circle`, `diamond`, `ellipse`, `cylinder` | 4 (bounding-box midpoints) | `top`, `right`, `bottom`, `left`                                        |
| `hexagon` (pointy)                                 | 6 (vertices)               | `top`, `top-right`, `bottom-right`, `bottom`, `bottom-left`, `top-left` |
| `hexagon` (flat)                                   | 6 (vertices)               | `right`, `top-right`, `top-left`, `left`, `bottom-left`, `bottom-right` |
| `triangle`                                         | 3–4 (varies by direction)  | e.g. `apex`, `base-left`, `base-right`, `base-mid`                      |
| All others (fallback)                              | 4 (bounding-box midpoints) | `top`, `right`, `bottom`, `left`                                        |

When you set `ports` explicitly on a `VizNode`, they **replace** the defaults entirely.

### Port utility functions

Import from `vizcraft`:

| Function              | Signature                                                  | Description                                                       |
| --------------------- | ---------------------------------------------------------- | ----------------------------------------------------------------- |
| `getDefaultPorts`     | `(shape: NodeShape) => NodePort[]`                         | Returns the default ports for a shape kind.                       |
| `getNodePorts`        | `(node: VizNode) => NodePort[]`                            | Returns explicit ports if set, otherwise defaults.                |
| `findPort`            | `(node: VizNode, portId: string) => NodePort \| undefined` | Looks up a port by id in the node's effective ports.              |
| `resolvePortPosition` | `(node: VizNode, portId: string) => Vec2 \| undefined`     | Returns the absolute position of a port (node position + offset). |

---

## NodeShape

Supported node geometry.

- `{ kind: 'circle'; r: number }` — circle with radius `r`.
- `{ kind: 'rect'; w: number; h: number; rx?: number }` — rectangle with optional corner radius.
- `{ kind: 'diamond'; w: number; h: number }` — diamond / rhombus.
- `{ kind: 'cylinder'; w: number; h: number; arcHeight?: number }` — cylinder (database symbol). Two elliptical caps connected by vertical sides. `arcHeight` defaults to ~15 % of `h`.
- `{ kind: 'hexagon'; r: number; orientation?: 'pointy' | 'flat' }` — regular hexagon. `r` is the outer (centre-to-vertex) radius. Default orientation is `'pointy'` (vertex at top).
- `{ kind: 'ellipse'; rx: number; ry: number }` — ellipse with independent horizontal (`rx`) and vertical (`ry`) radii.
- `{ kind: 'arc'; r: number; startAngle: number; endAngle: number; closed?: boolean }` — arc / pie slice. Angles in degrees (0 = right, 90 = bottom). When `closed` is `true` (default) the path closes back to the centre forming a pie; when `false` it renders an open arc stroke.
- `{ kind: 'blockArrow'; length: number; bodyWidth: number; headWidth: number; headLength: number; direction?: 'right' | 'left' | 'up' | 'down' }` — thick directional arrow polygon. `length` is tip-to-tail, `bodyWidth` is the shaft thickness, `headWidth` is the arrowhead wingspan, `headLength` is the arrowhead depth. `direction` defaults to `'right'`.
- `{ kind: 'callout'; w: number; h: number; rx?: number; pointerSide?: 'bottom' | 'top' | 'left' | 'right'; pointerHeight?: number; pointerWidth?: number; pointerPosition?: number }` — speech bubble / callout. A rounded rectangle body with a triangular pointer extending from one side. `pointerSide` defaults to `'bottom'`, `pointerPosition` (0–1) defaults to `0.3`, `pointerHeight` defaults to ~25 % of `h`, `pointerWidth` defaults to ~20 % of `w`.
- `{ kind: 'cloud'; w: number; h: number }` — cloud / thought bubble. A bumpy outline built from cubic Bézier arcs, sized to fit within the `w × h` bounding box. Anchor uses a bounding-ellipse approximation.
- `{ kind: 'cross'; size: number; barWidth?: number }` — cross / plus sign. A 12-vertex polygon inscribed in a square of the given `size`. `barWidth` defaults to ~33 % of `size`.
- `{ kind: 'cube'; w: number; h: number; depth?: number }` — 3D isometric cube / box. Rendered as three polygons (front face, top face, right face) with automatic brightness shading for the 3D effect. `depth` (isometric projection offset) defaults to ~20 % of `w`.
- `{ kind: 'document'; w: number; h: number; waveHeight?: number }` — document (wavy bottom). The standard ISO 5807 flowchart document symbol. A rectangle with a sine-wave-like curved bottom edge (single cubic Bézier). `waveHeight` defaults to ~10 % of `h`.
- `{ kind: 'note'; w: number; h: number; foldSize?: number }` — note (folded corner). The standard UML note / annotation symbol. A rectangle with a dog-eared top-right corner. The fold triangle is shaded darker for the paper-fold effect. `foldSize` defaults to `15`.
- `{ kind: 'parallelogram'; w: number; h: number; skew?: number }` — parallelogram (skewed rectangle). The standard ISO 5807 Input/Output flowchart symbol. The top edge is shifted right by `skew`. Defaults to ~20 % of `w`.
- `{ kind: 'star'; points: number; outerR: number; innerR?: number }` — multi-pointed star. `points` is the number of tips, `outerR` the tip radius, `innerR` the valley radius (defaults to ~40 % of `outerR`). Anchor uses an outer-radius circle approximation.
- `{ kind: 'trapezoid'; topW: number; bottomW: number; h: number }` — trapezoid. A quadrilateral with a shorter top edge (`topW`) and a longer bottom edge (`bottomW`). The standard ISO 5807 Manual Operation symbol. Swap the two widths for an inverted trapezoid (Manual Input). Anchor uses a bounding-box approximation based on the wider edge.
- `{ kind: 'triangle'; w: number; h: number; direction?: 'up' | 'down' | 'left' | 'right' }` — triangle. A 3-vertex polygon with base `w` and height `h`. `direction` controls which way the apex points (default `'up'`). Anchor uses a bounding-box approximation.
- `{ kind: 'path'; d: string; w: number; h: number }` — **custom SVG path** (escape hatch). `d` is any valid SVG path data string. `w` and `h` define the bounding box used for anchor computation and label centering. The path is translated so the bounding box center sits at the node position.

---

## VizRuntimeNodeProps

Numeric properties the core runtime patcher knows how to apply for nodes.

- `x?: number`
- `y?: number`
- `opacity?: number`
- `scale?: number`
- `rotation?: number`

---

## VizRuntimeEdgeProps

Numeric properties the core runtime patcher knows how to apply for edges.

- `strokeDashoffset?: number`
- `opacity?: number`

---

## AnimationSpec

A **portable, data-only timeline**.

An `AnimationSpec` is what `builder.animate((aBuilder) => ...)` compiles to, and what the player executes.

**Shape**

- `version: 'viz-anim/1'`
- `tweens: TweenSpec[]`

---

## TweenSpec

A single numeric tween.

**Shape**

- `kind: 'tween'`
- `target: AnimationTarget`
- `property: AnimProperty`
- `to: number`
- `duration: number` (ms)
- `delay?: number` (ms)
- `easing?: Ease`
- `from?: number` — optional explicit start value.

---

## AnimationTarget

Identifies _what_ you’re animating.

- Nodes use the form `node:<id>`.
- Edges use the form `edge:<id>` (commonly `edge:a->b`).

---

## AnimProperty

The property name being animated.

- Core properties are listed in `CoreAnimProperty`.
- You can also use any other string property name, as long as the playback adapter registers handlers for it.

---

## CoreAnimProperty

Properties supported out-of-the-box by the core adapter.

- Nodes: `x`, `y`, `opacity`, `scale`, `rotation`
- Edges: `opacity`, `strokeDashoffset`

---

## Ease

Built-in easing names.

- `linear`
- `easeIn`
- `easeOut`
- `easeInOut`

---

## AnimatableProps

The property bag you pass to `aBuilder.to(...)`.

- It hints core properties in TypeScript.
- It also permits arbitrary numeric keys (for custom properties).

---

## TweenOptions

Options you pass to `aBuilder.to(props, opts)`.

- `duration: number` (ms)
- `easing?: Ease`
- `from?: Partial<Record<AnimProperty, number>>` — per-property explicit start values.

---

## PlaybackController

Controller returned by `builder.play()` and `playAnimationSpec(...)`.

Common methods:

- `play()`
- `pause()`
- `stop()`

---

## ExtendAdapter (advanced)

Callback used to register custom animatable properties.

**Signature**

- `(adapter: AnimationHostAdapter & Partial<RegistrableAdapter>) => void`

You’ll typically use it via `aBuilder.extendAdapter((adapter) => { adapter.register?.(...) })`.

---

## AnimationHostAdapter and RegistrableAdapter (advanced)

These are the low-level interfaces the player uses to read/write properties.

- `AnimationHostAdapter` — must implement `get(target, prop)` and `set(target, prop, value)`.
- `RegistrableAdapter` — optional capability that exposes `register(kind, prop, { get, set })`.

---

## NodeOptions

Options object accepted by `viz().node(id, opts)`. Configures a node declaratively in a single call.

:::tip Re-opening a node
`node(id, opts)` returns `VizBuilder` (not `NodeBuilder`). To go back and add more properties to the same node later, call `.node(id)` **without** options — this re-opens the existing node and returns its `NodeBuilder` for further chaining. The builder stores nodes by id, so a second call reuses the same definition.
:::

**Key properties**

- `at?: { x: number; y: number }` — position.
- `cell?: { col: number; row: number; align?: 'center' | 'start' | 'end' }` — grid cell.
- Shape (pick one): `circle`, `rect`, `diamond`, `cylinder`, `hexagon`, `ellipse`, `arc`, `blockArrow`, `callout`, `cloud`, `cross`, `cube`, `path`, `document`, `note`, `parallelogram`, `star`, `trapezoid`, `triangle` — each accepts the same params as the corresponding fluent method.
- `fill?: string` — fill color.
- `stroke?: string | { color: string; width?: number }` — stroke color or stroke with width.
- `opacity?: number` — opacity.
- `zIndex?: number` — explicit rendering depth order.
- `className?: string` — CSS class.
- `label?: string | { text: string; fontSize?: number; fill?: string; … }` — label text or label with options.
- `image?: { href: string; w: number; h: number; dx?: number; dy?: number; position?: NodeMediaPosition; preserveAspectRatio?: string }` — embed an image (raster or SVG).
- `icon?: { id: string; size: number; color?: string; dx?: number; dy?: number; position?: NodeMediaPosition }` — embed an icon by id (from the icon registry).
- `svgContent?: { content: string; w: number; h: number; dx?: number; dy?: number; position?: NodeMediaPosition }` — embed inline SVG markup.
- `ports?: Array<{ id: string; offset: { x: number; y: number }; direction?: number }>` — connection ports.
- `container?: ContainerConfig` — marks this node as a container.
- `parent?: string` — parent container node id.
- `data?: unknown` — custom payload.
- `onClick?: (id: string, node: VizNode) => void` — click handler.

### NodeMediaPosition

Shared positioning options for `image`, `icon`, and `svgContent`.

- `'center'` (default)
- `'above'`
- `'below'`
- `'left'`
- `'right'`

### NodeOptions.image

Embedded image options for a node.

```typescript
image?: {
  href: string; // Image URL (raster, SVG, or data: URL)
  w: number;
  h: number;
  dx?: number;
  dy?: number;
  position?: NodeMediaPosition;
  preserveAspectRatio?: string;
}
```

### NodeOptions.icon

Embedded icon options. The icon content is resolved from the icon registry by `id`.

```typescript
icon?: {
  id: string;
  size: number;
  color?: string;
  dx?: number;
  dy?: number;
  position?: NodeMediaPosition;
}
```

### NodeOptions.svgContent

Embed inline SVG markup directly in the node.

```typescript
svgContent?: {
  content: string; // '<svg ...>...</svg>' or raw inner markup
  w: number;
  h: number;
  dx?: number;
  dy?: number;
  position?: NodeMediaPosition;
}
```

---

## EdgeOptions

Options object accepted by `viz().edge(from, to, opts)`. Configures an edge declaratively in a single call.

:::tip Re-opening an edge
`edge(from, to, opts)` returns `VizBuilder` (not `EdgeBuilder`). To continue editing the same edge, call `.edge(from, to)` or `.edge(from, to, id)` again without an options object — the existing edge definition is reused.
:::

**Key properties**

- `id?: string` — custom edge id (defaults to `"from->to"`).
- `routing?: EdgeRouting` — routing algorithm.
- `waypoints?: Vec2[]` — intermediate waypoints.
- `arrow?: boolean | 'both' | 'start' | 'end'` — arrow markers.
- `markerStart? / markerEnd?: EdgeMarkerType` — explicit marker types.
- `stroke?: string | { color: string; width?: number }` — stroke color or stroke with width.
- `fill?: string` — fill color.
- `opacity?: number` — opacity.
- `dash?: 'solid' | 'dashed' | 'dotted' | 'dash-dot' | string` — dash pattern.
- `className?: string` — CSS class.
- `anchor?: 'center' | 'boundary'` — connection anchor mode.
- `fromPort? / toPort?: string` — port ids for edge endpoints.
- `label?: string | labelObj | labelObj[]` — single or multi-position labels.
- `hitArea?: number` — invisible hit-area width.
- `meta?: Record<string, unknown>` — arbitrary consumer-defined metadata.
- `data?: unknown` — custom payload.
- `onClick?: (id: string, edge: VizEdge) => void` — click handler.
